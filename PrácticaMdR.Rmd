---
title: "PrácticaModelos"
author: "Marc Gil Arnau, Gonzalo Cruz Gómez, Yasmin Ezzarqtouni Marzoug"
date: "2025-02-20"
output: html_document
---

## Índice

## Introducción 

## Comprensión del problema


**Variables:** 

1. **X** - Coordenada espacial en el eje X dentro del mapa del parque Montesinho: de 1 a 9.
2. **Y** - Coordenada espacial en el eje Y dentro del mapa del parque Montesinho: de 2 a 9.
3. **month** - Mes del año: de "jan" (enero) a "dec" (diciembre).
4. **day** - Día de la semana: de "mon" (lunes) a "sun" (domingo).
5. **FFMC** - Índice FFMC del sistema FWI: de 18.7 a 96.20.
6. **DMC** - Índice DMC del sistema FWI: de 1.1 a 291.3.
7. **DC** - Índice DC del sistema FWI: de 7.9 a 860.6.
8. **ISI** - Índice ISI del sistema FWI: de 0.0 a 56.10.
9. **temp** - Temperatura en grados Celsius: de 2.2 a 33.30.
10. **RH** - Humedad relativa en %: de 15.0 a 100.
11. **wind** - Velocidad del viento en km/h: de 0.40 a 9.40.
12. **rain** - Lluvia en el exterior en mm/m²: de 0.0 a 6.4.
13. **area** - Área quemada del bosque (en hectáreas): de 0.00 a 1090.84.

## Comprensión de los datos y EDA
Cargamos los datos y las librerias
```{r}
library(readr)
library(caret) # Para la transformación Yeo-Johnson
library(lmtest) # Para la prueba de homocedastidad
library(corrplot)
library(dplyr)
library(ggplot2)
library(readr)
library(caret)
library(tidyverse)
library(knitr) 
library(corrplot)
library(gt)
library(GGally)
datos <- read.csv("forestfires.csv", sep=",", header=TRUE)
```

Visualizamos las primeras filas del dataset: 
```{r}
head(datos)
```

### EDA
Tamaño del dataset
```{r}
dim(datos)
```
Hay 517 observaciones y 13 variables.

Tipos de variables
```{r}
str(datos)
```
Variables continuas: FFMC, DMC, DC, ISI, temp, wind, rain y area.
Variables discretas: RH, X e Y. 
Variables texto: month y day.

Vamos a ver si tenemos valores faltantes: 
```{r}
anyNA(datos) 
```
No hay datos faltantes.

Vemos cuantos valores del target (area) son distintos de 0 y cuantos iguales a 0
```{r}
table(datos$area>0)
```

Primeramente vamos a hacer un análisis univariante: 
#### Estudio por variable:

##### **Área (variable objetivo):**

La variable **área** representa la superficie quemada en un incendio forestal, medida en hectáreas (ha). Los valores de esta variable varían de 0.00 a 1090.84 ha, pero está muy sesgada hacia 0.0, lo que indica que la mayoría de los incendios son pequeños. Esta variable es nuestra variable objetivo y nos sirve para entender la relación entre la magnitud del incendio y las condiciones meteorológicas y geográficas.

```{r}
summary(datos$area)    
```

```{r}
hist(datos$area, 
     main = "Histograma de Área Quemada", 
     xlab = "Área (hectáreas)", 
     ylab = "Frecuencia", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)  
```

**Análisis de la variable área**

Observamos que la variable tiene una distribución altamente sesgada hacia valores bajos, con un mínimo de 0.00 y una mediana de apenas 0.52 hectáreas, lo que indica que la mayoría de los incendios afectan superficies pequeñas. Sin embargo, la media de 12.85 hectáreas es significativamente más alta debido a valores extremos, como el máximo de 1090.84 hectáreas. 

* **Histograma:** tiene una distribución altamente sesgada hacia la derecha, con una concentración predominante de valores cercanos a 0.0 hectáreas. Esto indica que la mayoría de los incendios forestales registrados en el dataset abarcan áreas quemadas muy pequeñas, siendo los incendios de mayor magnitud eventos inusuales.

##### **Coordenada X**

La variable X representa la coordenada horizontal dentro del parque Montesinho en Portugal, donde se han registrado incendios forestales. Es una variable discreta con valores que oscilan entre 1 y 9, indicando la ubicación espacial de los incendios en el eje X del mapa. Esta variable nos permite situar geográficamente cada incendio.


```{r}
summary(datos$X)
```

```{r}
barplot(table(datos$X), col = "steelblue", main = "Distribución de X", xlab = "Coordenada X", ylab = "Frecuencia")

```

```{r}
table(datos$X)
```

**Análisis de los resultados de la variable X**

Los resultados de la variable X nos muestran que las coordenadas X dentro del parque Montesinho están distribuidas de manera relativamente centrada, con valores que van del **1** al **9**. La mayoría de los incendios se encuentran en las coordenadas **4** (91 incendios), **6** (86 incendios) y **2** (73 incendios), representando un porcentaje significativo de las observaciones.

El **mínimo es 1** y el **máximo es 9**, lo que indica que la variable **X** cubre un rango de ubicaciones en el eje horizontal del mapa del parque. La **media de 4.669** y la **mediana de 4** reflejan que la distribución de los incendios está ligeramente sesgada hacia las coordenadas más altas (6 y 7), ya que la media es mayor que la mediana.


##### **Coordenada Y**

La variable **Y** representa la coordenada vertical dentro del mapa del parque Montesinho en Portugal, similar a la variable **X**, pero en el eje vertical. Es una variable discreta, con valores que oscilan entre 2 y 9. Junto con la variable X, permite ubicar geográficamente los incendios forestales dentro del parque.

```{r}
summary(datos$Y)
```

```{r}
barplot(table(datos$Y), col = "steelblue", main = "Distribución de Y", xlab = "Coordenada Y", ylab = "Frecuencia")
```


```{r}
table(datos$Y)
```

**Análisis de la variable Y**

En la variable **Y** observamos que las coordenadas **4** y **6** concentran la mayoría de los incendios, mientras que la coordenada **8** tiene la menor frecuencia, con solo un registro. Esto sugiere que algunas áreas son más propensas a incendios que otras, posiblemente debido a factores como la vegetación, el clima o la exposición a condiciones meteorológicas más extremas.


##### **Mes**

La variable **mes** es una variable categórica que representa el mes del año en el que ocurrió cada incendio. Los valores posibles son los nombres de los 12 meses del año. Esta variable es clave para identificar patrones estacionales en la ocurrencia de incendios, ya que los incendios pueden estar influenciados por las condiciones climáticas específicas de cada mes.

```{r}
# Crear el gráfico
barplot(table(datos$month), 
        col = "steelblue", 
        main = "Distribución de los Incendios por Mes", 
        xlab = "Mes", 
        ylab = "Frecuencia",  
        las = 2)  # las = 2 para rotar los nombres de los meses
```


```{r}
table(datos$month)
```

**Análisis de la variable month**

La variable **month** nos muestra que los incendios son más comunes en los meses de **agosto y septiembre**, con 184 y 172 incendios registrados respectivamente, probablemente debido al clima más cálido y seco. En cambio, en **enero, mayo y noviembre** hay muy pocos incendios, con 2, 2 y 1 incendios respectivamente, lo que indica que estas épocas tienen un menor riesgo. Esto demuestra que los incendios siguen un patrón relacionado con las estaciones del año. 


##### **Día de la semana**

La variable **día** es una variable **categórica** que representa el día de la semana en que ocurrió un incendio forestal. Los valores posibles son 'mon' (lunes), 'tue' (martes), 'wed' (miércoles), 'thu' (jueves), 'fri' (viernes), 'sat' (sábado) y 'sun' (domingo). Esta variable nos dice en qué día de la semana ocurrió el incendio, lo que nos puede ayudar a identificar si hay patrones relacionados con los días en los que ocurren más incendios. 


```{r}
barplot(table(datos$day), main="Frecuencia de Días", col="steelblue", border="black")
```


```{r}
table(datos$day)
```

**Análisis de la variable day**

Los días **domingo** y **viernes** tienen la mayor cantidad de registros, con 95 y 85 incendios respectivamente, indicando que estos días tienen mayor actividad. Por otro lado, el miércoles presenta la menor frecuencia, con solo 54 incendios registrados, lo que sugiere una actividad más baja en este día. Los otros días tienen frecuencias intermedias, destacando variaciones en la ocurrencia de incendios a lo largo de la semana. Esto podría estar influenciado por factores como patrones climáticos o actividades humanas.


##### **FFMC (Fine Fuel Moisture Code)**

La variable **FFMC** (Fine Fuel Moisture Code) es un índice utilizado en el sistema de Índices de Peligro de Incendios Forestales (FWI). Este índice mide la **humedad de los combustibles finos**, como hojas secas y ramitas, que son fácilmente inflamables. Los valores de **FFMC** varían entre **18.7** y **96.20**, donde un valor bajo indica que los combustibles están más húmedos y, por lo tanto, es menos probable que se inicien incendios, mientras que un valor alto indica que los combustibles están muy secos y es más fácil que se produzcan incendios.

```{r}
summary(datos$FFMC)
```

```{r}
hist(datos$FFMC, 
     main = "Distribución de FFMC (Fine Fuel Moisture Code)", 
     xlab = "FFMC", 
     ylab = "Frecuencia", 
     col = "steelblue", 
     border = "black", 
     breaks = 50)
```

```{r}
boxplot(datos$FFMC, 
        main = "Boxplot de FFMC (Fine Fuel Moisture Code)", 
        ylab = "FFMC", 
        col = "lightgreen")
```
**Análisis de la variable FFMC**

* **Histograma:** muestra una distribución sesgada a la izquierda con la mayoría de los valores concentrados entre 80 y 100. Esto indica que, en la mayoría de los casos, el combustible fino (como hojas y ramas pequeñas) tiene muy poca humedad, lo que incrementa el riesgo de incendio.

* **Boxplot:** nos muestra que la mayoría de los valores son altos, reflejando condiciones muy secas. La mediana está cercana al extremo superior, lo que confirma esta tendencia. Además, hay algunos valores atípicos en el rango bajo, que representan casos aislados de condiciones de menor humedad.

###### **DMC (Duff Moisture Code)**

La variable **DMC** (Duff Moisture Code) es otro índice del sistema FWI (Fire Weather Index) utilizado para medir la **humedad de los combustibles más gruesos**, como hojas y ramas secas, que son más difíciles de incendiar pero que pueden contribuir a la propagación del fuego.

Los valores de DMC varían entre 1.1 y 291.3, donde un valor bajo indica que los combustibles están relativamente húmedos y es menos probable que se inicie un incendio, mientras que un valor alto sugiere que los combustibles están secos y hay mayor riesgo de incendio.


```{r}
summary(datos$DMC)
```

```{r}
hist(datos$DMC, 
     main = "Histograma de DMC (Duff Moisture Code)", 
     xlab = "DMC", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)
```

```{r}
boxplot(datos$DMC, 
        main = "Boxplot de DMC (Duff Moisture Code)", 
        ylab = "DMC", 
        col = "lightgreen")
```

**Análisis de los resultados de DMC**

* **Histograma:** muestra que los valores más comunes de humedad de los combustibles gruesos están entre 50 y 150, con un pico alrededor de 100. Valores de DMC altos, que indican mayor riesgo de incendio, son menos frecuentes. Esto sugiere que, en general, los combustibles son moderadamente húmedos, pero aún existe un riesgo de incendios en condiciones de baja humedad.

* **Boxplot:** observamos valores atípicos en la parte superior entre 250 y 300, lo que indica que en algunos incendios el suelo estaba extremadamente seco. La mediana está en la parte media del rango, indicando que la mayoría de los incendios ocurren cuando la humedad del suelo está moderada o baja.




##### **DC**

La variable **DC** (Drought Code) es un índice del sistema FWI que mide la **sequedad de los combustibles más profundos** y de mayor tamaño, como la capa de tierra seca y material orgánico en descomposición. Su rango va de 7.9 a 860.6, donde valores bajos indican mayor humedad y menor riesgo de incendio, mientras que valores altos reflejan sequedad extrema y un mayor riesgo de propagación del fuego.

```{r}
summary(datos$DC)
```

```{r}
hist(datos$DC, 
     main = "Histograma de DC (Drought Code)", 
     xlab = "DC", 
     col = "steelblue", 
     border = "black", 
     breaks = 30)
```

```{r}
boxplot(datos$DC, 
        main = "Boxplot de DC (Drought Code)", 
        ylab = "DC", 
        col = "lightgreen")
```
**Análisis de los resultados de DC**

- **Histograma:** la distribución sesgada hacia la izquierda (asimetría positiva) muestra que la mayoría de los valores están entre 600 y 800, con un pico claro alrededor de 700, lo que refleja condiciones frecuentes de sequedad acumulada alta. Este patrón implica un mayor riesgo de incendios debido a la abundancia de material seco, aunque también se observa una ligera asimetría hacia valores más bajos.

- **Boxplot:** la mediana del DC está cerca de 700, confirmando la concentración observada en el histograma. Además, observamos que algunos valores atípicos más bajos podrían corresponder a periodos de mayor humedad o climas inusualmente húmedos.


##### **ISI (Initial Spread Index)**

La variable **ISI** (Initial Spread Index) es otro índice del sistema FWI (Fire Weather Index) que mide la **velocidad de propagación** del fuego en condiciones de viento y humedad actuales. Este índice se calcula utilizando la temperatura, la humedad relativa y la velocidad del viento, y refleja el riesgo inmediato de propagación del fuego bajo condiciones meteorológicas específicas.

Los valores de ISI van de 0.0 a 56.10, donde un valor bajo indica que las condiciones para la propagación del fuego son favorables, mientras que un valor más alto sugiere un riesgo elevado, ya que el fuego se propaga más rápido debido a condiciones más secas y vientos fuertes.

```{r}
summary(datos$ISI)
```

```{r}
hist(datos$ISI, 
     main = "Histograma de ISI (Initial Spread Index)", 
     xlab = "ISI", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)

```


```{r}
boxplot(datos$ISI, 
        main = "Boxplot de ISI (Initial Spread Index)", 
        ylab = "ISI", 
        col = "lightgreen")

```
**Análisis de a variable ISI**

* **Histograma:** el histograma tiene una distribución unimodal asimétrica positiva. La mayoría de los valores de ISI se encuentran entre 0 y 20, con un pico claro alrededor de 10, indicando que, generalmente, las condiciones iniciales de propagación del fuego tienden a ser bajas o moderadas, con pocos casos extremos.

* **Boxplot:**  muestra una mediana de 8.4, con la mayoría de los valores entre 0 y 20. Los valores atípicos son principalmente superiores a 20, indicando incendios de propagación rápida, mientras que un valor atípico en 0 podría reflejar condiciones de baja propagación debido a alta humedad o falta de viento. 



##### **Temperatura en °C**

La variable **temperatura** mide la temperatura del aire en grados Celsius. En nuestro contexto, la temperatura es un factor crucial porque influye directamente en el comportamiento del fuego. Las temperaturas más altas tienden a aumentar la deshidratación de la vegetación, haciendo que sean más propensos a prenderse fuego.

Los valores de la variable temperatura oscilan entre 2.2°C y 33.3°C, con valores más altos generalmente asociándose con mayores riesgos de incendios.

```{r}
summary(datos$temp)
```

```{r}
hist(datos$temp, 
     main = "Histograma de Temperatura", 
     xlab = "Temperatura (°C)", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)

```
```{r}
boxplot(datos$temp, 
        main = "Boxplot de Temperatura", 
        ylab = "ISI", 
        col = "lightgreen")

```

**Análisis de los resultados**

- **Histograma:** La distribución es ligeramente simétrica, con una mayor concentración entre 15°C y 25°C, lo que sugiere que los incendios ocurren en temperaturas moderadas a cálidas, pero no necesariamente en los días más calurosos.

- **Boxplot:** muestra que la mediana está en 19.30°C, con la mayoría de los valores entre 15 y 25°C. Los valores atípicos (outliers) están por debajo de 5°C, lo que podría reflejar condiciones inusuales de temperatura baja en algunas áreas, posiblemente relacionadas con condiciones meteorológicas excepcionales.

##### **RH (humedad relativa)**

La **humedad relativa** (RH) mide el porcentaje de vapor de agua en el aire. En incendios forestales, una baja humedad relativa (aire más seco) aumenta el riesgo de propagación del fuego, mientras que una alta humedad relativa dificulta el encendido y la expansión del fuego. Los valores de RH en este conjunto de datos varían entre 15% y 100%.


```{r}
summary(datos$RH) 
```

```{r}

hist(datos$RH, 
     main = "Histograma de Humedad Relativa", 
     xlab = "Humedad Relativa (%)", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)

```


```{r}

boxplot(datos$RH, 
        main = "Boxplot de Humedad Relativa", 
        ylab = "Humedad Relativa (%)", 
        col = "lightgreen")

```
* **Histograma:** muestra que la mayoría de los valores se concentran entre el 20% y el 60%, con picos significativos alrededor del 30% y el 40%. La frecuencia de valores de RH disminuye notablemente tanto por debajo del 20% como por encima del 60%.En general, esto sugiere que en muchas de las condiciones observadas, la humedad del aire está en niveles que podrían permitir la propagación del fuego, aunque no de forma extrema.

* **Boxplot:** el rango intercuartílico (IQR) va aproximadamente del 30% al 60%, con una mediana cercana al 45%. Además, se observan algunos valores atípicos por encima del 80%.

###### **Wind**

La variable **wind** mide la velocidad del viento en km/h. El viento influye en la propagación de los incendios, ya que un viento fuerte puede hacer que el fuego se propague más rápido, mientras que un viento débil ralentiza su expansión. Los valores de wind en nuestro conjunto de datos varían entre 0.4 km/h y 9.4 km/h.

```{r}
summary(datos$wind)
```

```{r}

hist(datos$wind, 
     main = "Histograma de Velocidad del Viento", 
     xlab = "Velocidad del Viento (km/h)", 
     col = "steelblue", 
     border = "black", 
     breaks = 30)

```

```{r}

boxplot(datos$wind, 
        main = "Boxplot de Velocidad del Viento", 
        ylab = "Velocidad del Viento (km/h)", 
        col = "lightgreen")

```

**Análisis de wind**

* **El Histograma** muestra una distribución ligeramente sesgada a la derecha, indicando que la mayoría de las mediciones se concentran en valores más bajos, con algunos casos de vientos más fuertes. La moda se encuentra alrededor de 4 km/h, siendo la velocidad más frecuente registrada en los datos. La dispersión sugiere que la mayoría de los valores oscilan entre 2 km/h y 6 km/h, con una menor frecuencia de velocidades superiores a 8 km/h, esto significa que, aunque la mayoría de los vientos son suaves o moderados, a veces se presentan ráfagas más fuertes, aunque no son muy comunes


* **El boxplot** la velocidad del viento está mayormente distribuida entre 3 km/h y 5.5 km/h, con una mediana en 4 km/h. Los bigotes se extienden desde aproximadamente 1 km/h hasta 8 km/h, lo que muestra el rango normal de variabilidad en la velocidad del viento. Observamos varios valores atípicos por encima de 8 km/h, lo que indica que hay episodios ocasionales de viento fuerte.


###### **Rain**

La variable **rain** mide la cantidad de lluvia en mm/m². Indica la cantidad de precipitación caída en un área durante un período determinado. En el contexto de los incendios forestales, la lluvia juega un papel crucial, ya que puede disminuir el riesgo de incendios al mojar la vegetación y los combustibles, dificultando su ignición y propagación. Por el contrario, la falta de lluvia contribuye a que la vegetación se seque, lo que aumenta el riesgo de incendios. Los valores de rain en este conjunto de datos varían entre 0.0 mm/m² y 6.4 mm/m².

```{r}
summary(datos$rain)
```

```{r}
# Histograma de la variable Rain (lluvia)
hist(datos$rain, 
     main = "Histograma de Lluvia", 
     xlab = "Cantidad de Lluvia (mm/m²)", 
     col = "steelblue", 
     border = "black", 
     breaks = 40)

```
* **Histograma*:* esta  sesgada hacia valores bajos (casi todos los datos son 0), lo que sugiere que los incendios ocurren mayoritariamente en condiciones secas, con lluvia muy poco frecuente o inexistente. La presencia de un pequeño número de valores no nulos podría reflejar lluvias ocasionales que no son suficientes para mitigar significativamente el riesgo de incendio.


Vamos a ver cómo se relacionan nuestras variables mediante un análisis multivariante. 

Primeramente vamos a hacer una matriz de correlaciones para ver cómo de correladas están nuestras variables. 


```{r}
# Matriz de correlación
numeric_data <- datos[, sapply(datos, is.numeric)]

correlation_matrix <- cor(numeric_data)

print(correlation_matrix)

corrplot(correlation_matrix, method = "circle")
```

1. Correlaciones fuertes:

- DMC y DC tienen una correlación de 0.68, indicando que el contenido de humedad en el suelo está relacionado con la sequedad del terreno.

- FFMC y ISI tienen 0.53, lo que sugiere que ambos índices están relacionados con la propagación del fuego.

- FFMC y temp tienen 0.43, lo que indica que las temperaturas más altas favorecen condiciones secas para los incendios.

2. Correlaciones negativas moderadas:

- temp y RH tienen -0.53, lo que refleja que temperaturas altas están asociadas con baja humedad.

- RH y FFMC tienen -0.30, mostrando que mayor humedad relativa reduce los niveles del índice FFMC.

3. Correlaciones bajas o sin relación clara:

- wind tiene correlaciones bajas con la mayoría de las variables.

- rain tiene correlaciones débiles con área, sugiriendo que la lluvia no afecta significativamente el tamaño del incendio.

4. Con respecto a área:

- Las variables como X y Y muestran correlaciones bajas con área, lo que sugiere que la ubicación no está muy relacionada con el tamaño de los incendios.

- FFMC, DMC y ISI también tienen correlaciones bajas con el área quemada, aunque están relacionadas con otras condiciones que favorecen los incendios.

Podemos ver que hay bastante correlación entre algunas de nuestras variables. Es por ello que más adelante tendremos que hacer una selección de variables. 

Si hacemos un pairs plot, podremos ver claramente cómo están relacionadas dichas variables: 
```{r}
variables <- c("FFMC", "DMC", "DC", "ISI", "temp", "RH", "X", "Y")

pairs(datos[, variables], 
      main = "Pairs Plot")
```

Podemos ver como DC y DMC tienen una relación bastante lineal, temp y RH también, aunque en este caso se trata de una recta descendiente, como pudimos ver por la correlación negativa de nuestras variables. FFMC sigue una relación bastante lineal con ISI, aunque también se puede ver con temp, DMC, DC, incluso con RH; aunque al estar estos valores todos en la parte superior de la gráfica puede ser difícil verlo. 

A continuación vamos a ver cómo se relacionan nuestras variables con la variable objetivo, con ello buscaremos encontrar relaciones que nos faciliten las tareas de regresión. 

Primeramente, vamos a ver cual es el mes en el que más área se quema : 

Para ello primeramente ordenaremos los meses para que aparezcan de enero a diciembre y después los transformaremos en factores. 
```{r}
month_order <- c("jan", "feb", "mar", "apr", "may", "jun",
                 "jul", "aug", "sep", "oct", "nov", "dec")
datos$month <- factor(datos$month, levels = month_order) 
ggplot(datos, aes(x = month, y = area)) +
  geom_line() +
  geom_point() +
  labs(title = "Area over Months", x = "Month", y = "Area")

ggplot(datos, aes(x = month, y = area)) +
  geom_bar(stat = "identity") +
  labs(title = "Area by Month", x = "Month", y = "Area")

```
Vemos como el mes en el que más área se quema es septiembre, seguido de agosto. También podemos ver que la mayoría de incendios cubren un área relativamente pequeña, no superando en su mayoría las 200 ha, sin embargo tenemos tres incendios muy grandes en nuestros datos, uno en julio que quemó cerca de 300 ha, uno en agosto que quemó unas 750 ha y por último, el más grande, que tuvo lugar en septiembre y quemó más de 1000 ha.

De la matriz de correlaciones ya podemos extraer que ninguna variable va a tener relación alguna con nuestra variable objetivo, aun así vamos a visualizar nuestras variables frente a la variable objetivo para comprobarlo: 

Primeramente lo haremos con la temperatura, que es la variable que, aunque muy poca, tiene más correlación con el área 
```{r}
ggplot(datos, aes(x = temp, y = area)) +
  geom_point() +
  labs(x = "temp", y = "area", title = "temp vs. area") +
  theme_bw()

```
Podemos probar a eliminar los ceros a ver si, cuando hay un incendio, la temperatura tiene algo que ver: 

```{r}
datos_filtrados <- datos %>% filter(area != 0)
ggplot(datos_filtrados, aes(x = temp, y = area)) +
  geom_point() +
  labs(x = "temp", y = "area", title = "temp vs. area") +
  theme_bw()

```
Vemos que, como la mayoría de los incendios que hay son pequeños, no vemos ninguna relación. A pesar de eso, destacan los incendios grandes que comentamos anteriormente, en los cuales se puede ver que la temperatura era mayor de 25 grados, lo cual indica una temperatura relativamente alta. 

Vamos a ver el resto de variables: 
```{r}
plot_area_variables <- function(datos) {
  variables <- c("FFMC", "DMC", "DC", "ISI", "RH", "wind", "rain") 

  for (var in variables) {
    p1 <- ggplot(datos, aes(x = .data[[var]], y = area)) +
      geom_point() +
      labs(x = var, y = "area", title = paste(var, "vs. area")) +
      theme_bw()
    print(p1)
  }
}
plot_area_variables(datos)
```
Vemos como ninguna tiene relación lineal con la variable objetivo. Aunque si que es cierto que, a mayor FFMC, nos encontramos un mayor volumen de incendios, además de los dos grandes incendios que tenemos en el dataset. 

Vamos a probar de nuevo a eliminar los ceros a ver si tenemos alguna relación

```{r}
plot_area_variables <- function(datos_filtrados) {
  variables <- c("FFMC", "DMC", "DC", "ISI", "RH", "wind", "rain") 

  for (var in variables) {
    p1 <- ggplot(datos_filtrados, aes(x = .data[[var]], y = area)) +
      geom_point() +
      labs(x = var, y = "area", title = paste(var, "vs. area")) +
      theme_bw()
    print(p1)
  }
}
plot_area_variables(datos_filtrados)
```
Vemos como de nuevo no podemos extraer una relación clara entre nuestras variables y la variable objetivo. Esto significa que cuando apliquemos regresión lineal a nuestra variable objetivo, no obtendremos un modelo que pueda predecir de manera óptima. Es por ello que tendremos que hacer transformaciones de nuestras variables, para poder hacer modelos no lineales que nos ayuden a predecir mejor nuestro target. También de todas estas gráficas, podemos ver los dos incendios grandes de manera clara, ya que el valor del área es mucho más grande en estos dos casos que en los demás. 

## Modelo de regresión lineal simple

Creación de funciones para evitar repetimiento.

```{r}
# Gráfico de residuos vs valores ajustados
grafico_residuos_vs_ajustados <- function(modelo) {
  residuos <- resid(modelo)
  valores_ajustados <- fitted(modelo)
  
  ggplot(data = NULL, aes(x = valores_ajustados, y = residuos)) +
    geom_point(color = "blue") +
    geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
    labs(title = "Residuos vs Valores Ajustados",
         x = "Valores Ajustados",
         y = "Residuos") +
    theme_minimal()
}

# Histograma de residuos
grafico_histograma_residuos <- function(modelo) {
  residuos <- resid(modelo)
  
  hist(residuos,
     main = "Histograma de Residuos",
     xlab = "Residuos",
     col = "lightblue", border = "black")
  
  invisible(NULL)
}

# QQ-Plot de residuos
grafico_qqplot_residuos <- function(modelo) {
  residuos <- resid(modelo)
  
  qqnorm(residuos, main = "QQ-Plot de los Residuos")
  qqline(residuos, col = "red", lwd = 2)
}

# Gráfico de residuos vs variable explicativa
grafico_residuos_vs_variable <- function(modelo, datos, variable_explicativa) {
  residuos <- resid(modelo)
  
  ggplot(data = datos, aes(x = .data[[variable_explicativa]], y = residuos)) +
    geom_point(color = "purple") +
    geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
    labs(title = paste("Residuos vs", variable_explicativa),
         x = variable_explicativa,
         y = "Residuos") +
    theme_minimal()
}
```


```{r}
# Ajustar el modelo de regresión lineal simple
modelo_simple <- lm(area ~ temp, data = datos)

# Residuos del modelo
residuos <- resid(modelo_simple)

# Mostrar resumen del modelo
summary(modelo_simple)
```

El análisis de regresión lineal entre la variable objetivo, "area" y la temperatura tiene un $R^2$ extremadamente bajo. Este resultado indica que la temperatura, por sí sola, apenas explica la variabilidad observada en los incendios forestales.

El bajo valor del $R^2$ nos lleva a dos conclusiones: primero, que la relación lineal directa entre temperatura y área afectada es prácticamente inexistente en estos datos, segundo, que serán necesarios enfoques más complejos para modelar adecuadamente este dataset, ya que tal vez la relación no sea lineal sino de otro tipo. 

También es importante considerar que la presencia mayoritaria de incendios inexistentes (valor de cero en la variable "area") esté distorsionando la capacidad predictiva del modelo. En cualquier caso, estos resultados sugieren la necesidad de explorar alternativas.


Debido a estos resultados, para determinar qué variables meteorológicas de forma aislada tienen mayor influencia en el área quemada por los incendios forestales, vamos a calcular para cada caso el $R^2$ que nos indica el porcentaje de variabilidad explicada.

```{r}
# Lista de variables
variables <- c("temp", "RH", "wind", "FFMC", "DMC", "DC", "ISI", "rain")

# Bucle para calcular R² de cada modelo
for (var in variables) {
  modelo <- lm(paste("area ~", var), data = datos)
  r2 <- summary(modelo)$r.squared
  cat("El modelo con", var, "tiene un R² de:", round(r2, 4), "\n")
}
```

Los resultados indican que todos los modelos individuales presentan valores de $R^2$ muy bajos. Esto confirma que ninguna de las variables meteorológicas analizadas de forma aislada tiene capacidad para explicar las variaciones en los incendios forestales. Y podemos concluir que un modelo multivariable de los fenómenos de incendios puede ser más determinante que la influencia individual.

A pesar de los valores bajos del $R^2$ que no resultan significativas para un modelo, hemos seleccionado como ejemplo el modelo basado en la temperatura. Esta elección se debe por ser un parámetro meteorológico fácilmente comprensible.

#### Gráfico de residuos vs valores ajustados

```{r}
print(grafico_residuos_vs_ajustados(modelo_simple))
```

El gráfico de "Residuos vs Valores Ajustados" ayuda a identificar si la relación entre la variable explicativa y la variable respuesta es lineal y si se cumple la homocedasticidad. En este caso, se observa que los residuos no se distribuyen aleatoriamente alrededor del cero, lo que sugiere que el modelo no captura adecuadamente la relación entre las variables podría no ser lineal, indicando la posible necesidad de incorporar términos no lineales o transformaciones de variables al modelo.

La dispersión de los residuos presenta heterogeneidad donde la varianza de los errores no se mantiene constante, sino que parece incrementarse levemente para predicciones mayores. Además, se identifican varios puntos alejados del grupo principal que podrían corresponder a observaciones atípicas.

####  Histograma de residuos

```{r}
print(grafico_histograma_residuos(modelo_simple))
```

El histograma de residuos muestra la distribución de los residuos. En este caso, se observa una gran concentración de residuos cerca de cero, pero hay algunos valores atípicos que no se ajustan bien como se ha comentado anteriormente. El gráfico sugiere que las variables no siguen una distribución normal.

#### QQ-Plot de residuos

```{r}
print(grafico_qqplot_residuos(modelo_simple))
```

El "QQ-Plot" compara la distribución de los residuos con una distribución normal. Si los puntos se alinean con la línea diagonal, los residuos siguen una distribución normal. En este caso, se observa que los residuos no siguen una distribución normal en la cola derecha.

#### Gráfico de residuos vs temperatura

```{r}
print(grafico_residuos_vs_variable(modelo_simple, datos, "temp"))
```

Este gráfico muestra los residuos frente a la variable explicativa, "temp". Si hay un patrón claro en los residuos, esto sugiere que el modelo no está capturando adecuadamente la relación entre las variables.

En este caso muestra una distribución no aleatoria de los residuos que se agrupan principalmente en la zona inferior del gráfico con una marcada dispersión que aumenta conforme lo hacen los valores de temperatura junto con la presencia de varios valores atípicos significativos Esta disposición evidencia problemas de heterocedasticidad donde la variabilidad de los residuos no es constante.

#### Prueba de Breusch-Pagan para homocedasticidad

```{r}
breusch_pagan <- bptest(modelo_simple)
print(breusch_pagan)
```

La prueba de Breusch-Pagan evalúa si la varianza de los residuos es constante, es decir si hay homocedasticidad. Un p-valor menor a 0.05 sugiere heterocedasticidad. En este caso, el p-valor es mayor a 0.05 lo que sugiere homocedasticidad. Sin embargo, esta conclusión contradice las conclusiones anteriores.  

Esta contradicción puede explicarse por las limitaciones que presenta test de breusch-pagan cuando se trata con distribuciones asimétricas o en presencia de valores atípicos, condiciones presentes en nuestro análisis. Además, el test puede no detectar irregularidades que desde un punto de vista práctico son relevantes para la calidad del modelo.

Por lo que tomamos este valor con pinzas por lo comentado y porque no creemos que el p-valor sea lo suficientemente alto para que sea verdaramente decisivo a la hora de decidir que el modelo es homocedastico.

#### Prueba de Shapiro-Wilk para normalidad de los residuos

```{r}
shapiro_test <- shapiro.test(residuos)
print(shapiro_test)
```

La prueba de Shapiro-Wilk evalúa si los residuos siguen una distribución normal. Un p-valor menor a 0.05 sugiere que los residuos no son normales. En este caso, el p-valor es menor a  0.05 lo que confirma las conclusiones que hemos podido sacar de los gráficos.

#### Prueba de Durbin-Watson para autocorrelación de los residuos

```{r}
durbin_watson <- dwtest(modelo_simple)
print(durbin_watson)
```

La prueba de Durbin-Watson evalúa si los residuos están autocorrelacionados. Un valor cercano a 2 sugiere que no hay autocorrelación. En este caso, el estadístico es menor a 0.05 lo que sugiere autocorrelación.


Como se ha comentado, la abundancia de ceros pueden estar ocultando relaciones entre las variables y la extensión de los incendios. Para verificar este efecto, vamos a realizar un modelo que excluya estos casos, lo que nos permitirá evaluar cómo los efectos meteorológicos afectan el tamaño de los incendios cuando estos ocurren. 

### Repetir el proceso para el modelo sin ceros en "area"

```{r}
# Filtrar datos sin ceros en "area"
datos2 <- datos[datos$area > 0, ]

# Ajustar el modelo de regresión lineal simple sin ceros
modelo_simple2 <- lm(area ~ temp, data = datos2)

# Residuos del modelo
residuos2 <- resid(modelo_simple2)

# Mostrar resumen del segundo modelo
summary(modelo_simple2)
```

Observamos que el valor del $R^2$ entre la variable "area" y la temperatura ha  mejorado ligeramente en comparación con los modelos que incluían todos los datos. Sin embargo, esta mejora del valor sigue siendo extremadamente bajo, por lo que vamos volver a calcular para cada caso el $R2$ y compararlos

```{r}
# Bucle para calcular R**2 de cada modelo
for (var in variables) {
  modelo2 <- lm(paste("area ~", var), data = datos2)
  r2 <- summary(modelo2)$r.squared                   
  cat("El modelo con", var, "tiene un R² de:", round(r2, 4), "\n")
}
```

Incluso tras quitar las observaciones con área cero, los $R^2$ siguen siendo extremadamente bajos, confirmando que ningún predictor individual explica significativamente la variación de los incendios. 

Aunque los resultados no son significativos, vamos a revisar el modelo entre "area" y la temperatura por si los supuestos se cumplen o por lo menos tienen una mejora significativa.

#### Gráfico de residuos vs valores ajustados sin ceros

```{r}
print(grafico_residuos_vs_ajustados(modelo_simple2))
```

Los residuos siguen sin distribuirse de forma aleatoriamente alrededor del cero por lo que el modelo no captura adecuadamente la relación entre la variable explicativa y la variable respuesta.

####  Histograma de residuos sin ceros

```{r}
print(grafico_histograma_residuos(modelo_simple2))
```

El análisis del histograma de residuos tras eliminar las observaciones con área cero revela una ligera mejora en la distribución,, pero sigue teniendo problemas de normalidad. 

#### QQ-Plot de residuos sin ceros

```{r}
print(grafico_qqplot_residuos(modelo_simple2))
```

En este caso, se observa que los residuos no siguen una distribución normal, especialmente en la cola derecha. Esto coincide con lo observado en el histograma de residuos y refuerzan las limitaciones del enfoque de regresión lineal.

#### Gráfico de residuos vs temperatura sin ceros

```{r}
print(grafico_residuos_vs_variable(modelo_simple2, datos2, "temp"))
```

Los residuos siguen agrupados en la zona inferior del gráfico evidenciando problemas de heterocedasticidad. La persistencia de estos problemas tras eliminar los ceros sugiere que las limitaciones del modelo van más allá de la distribución inicial de los datos.


Los modelos lineales simples no son los indicados para intentar predecir el area de un incendio, este hecho era algo previsible ya que los incendios son fenómenos meteorológicos complejos que dependen de muchos factores. Para intentar mejorar la predicción vamos a implementar un modelo de regresión lineal múltiple.

## Modelo de regresión lineal múltiple

```{r}
# Ajuste del modelo completo
modelo_multiple <- lm(area ~ temp + RH + wind + FFMC + DMC + DC + ISI + rain, data = datos)

# Obtener los residuos
residuos_multiple <- resid(modelo_completo)

# Resumen estadístico
summary(modelo_multiple)
```



#### Gráfico de residuos vs valores ajustados 

```{r}
print(grafico_residuos_vs_ajustados(modelo_multiple))
```

En el gráfico de "Residuos vs Valores Ajustados" se observa que tal y como ocurria en el modelo lineal los residuos no se distribuyen aleatoriamente alrededor del cero y la dispersión de los residuos es heterogenia con una varianza que se incrementa a medida que los valores ajustados aumentan. 

####  Histograma de residuos

```{r}
print(grafico_histograma_residuos(modelo_multiple))
```

#### QQ-Plot de residuos

```{r}
print(grafico_qqplot_residuos(modelo_multiple))
```

Al histograma de residuos y al El "QQ-Plot" les ocurre lo mismo que al modelo simple, al primero gran concentración de residuos cerca del cero y con presencia de valores atípicos, en el segundo los residuos no siguen una distribución normal en la cola derecha. Ambos sugieren que no se sigue una distribución normal.

#### Prueba de Breusch-Pagan para homocedasticidad

```{r}
breusch_pagan <- bptest(modelo_multiple)
print(breusch_pagan)
```

El p-valor es mayor a 0.05 al igual que en el modelo lineal simple lo que sugiere homocedasticidad. Sin embargo, esta conclusión contradice las conclusiones anteriores. La gran diferencia en este caso es que esta vez el p-valor es diez veces mayor al anterior, por lo tanto es mucho mayor a 0.05.
Pero como se ha comentado este test no es especialmente bueno cuando trata con distribuciones asimétricas o en presencia de valores atípicos. Por lo que este valor no es determinante frente a las suposiciones sacadas de los gráficos.

#### Prueba de Shapiro-Wilk para normalidad de los residuos

```{r}
shapiro_test <- shapiro.test(residuos_multiple)
print(shapiro_test)
```

Con la prueba de Shapiro-Wilk comprobamos que el p-valor es menor a  0.05 lo que confirma las conclusiones que hemos podido sacar de los gráficos de que el modelo no sigue una distribución normal.

#### Prueba de Durbin-Watson para autocorrelación de los residuos

```{r}
durbin_watson <- dwtest(modelo_multiple)
print(durbin_watson)
```

El p-valor de la prueba de Durbin-Watson es menor a 0.05, por lo tanto los residuos del modelo son autocorrelados.


Hemos podido comprobar que al igual que pasaba con el modelo de regresión lineal simple, el modelo lineal múltiple no cumplen los supuestos. Esto nos está indicando que un modelo lineal no es el indicado para nuestro caso, por lo tanto lo tendremos que obtar por o bien seleccionar y transformar las variables o intentar aplicar modelos no lineales.


## Selección de variables y regularización

## Modelos no lineales

## Conclusiones
